<!-- Chat Component Template -->
<div class="flex flex-col h-screen bg-surface-0 dark:bg-surface-900">
  <!-- Messages Display Area -->
  <div 
    #messagesContainer
    class="flex-1 overflow-y-auto p-4 space-y-4"
    role="log"
    aria-live="polite"
    aria-relevant="additions"
  >
    <!-- Message Loop -->
    <ng-container *ngFor="let message of messages">
      <!-- Date Separator -->
      <div 
        *ngIf="message.isNewDay" 
        class="flex justify-center my-4"
      >
        <span class="px-4 py-1 text-xs font-medium text-surface-600 dark:text-surface-400 bg-surface-100 dark:bg-surface-800 rounded-full">
          {{ message.dateLabel }}
        </span>
      </div>

      <!-- User Message (Right-aligned) -->
      <div 
        *ngIf="message.senderId === 'user'" 
        class="flex justify-end"
      >
        <div class="flex flex-col items-end max-w-[75%] md:max-w-[60%]">
          <div class="bg-primary-100 dark:bg-primary-900 text-surface-900 dark:text-surface-0 rounded-2xl rounded-tr-sm px-4 py-3 shadow-sm">
            <p class="text-sm whitespace-pre-wrap break-words">{{ message.content }}</p>
          </div>
          <span class="text-xs text-surface-500 dark:text-surface-400 mt-1 px-2">
            {{ message.time }}
          </span>
        </div>
      </div>

      <!-- AI Message (Left-aligned) -->
      <div 
        *ngIf="message.senderId === 'ai'" 
        class="flex justify-start"
      >
        <div class="flex flex-col items-start max-w-[75%] md:max-w-[60%]">
          <div class="bg-surface-100 dark:bg-surface-700 text-surface-900 dark:text-surface-0 rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm">
            <p class="text-sm whitespace-pre-wrap break-words">{{ message.content }}</p>
          </div>
          <span class="text-xs text-surface-500 dark:text-surface-400 mt-1 px-2">
            {{ message.time }}
          </span>
        </div>
      </div>
    </ng-container>

    <!-- Typing Indicator -->
    <div 
      *ngIf="isTyping" 
      class="flex justify-start"
    >
      <div class="bg-surface-100 dark:bg-surface-700 rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm">
        <div class="flex space-x-1">
          <span class="w-2 h-2 bg-surface-400 dark:bg-surface-500 rounded-full animate-bounce" style="animation-delay: 0ms;"></span>
          <span class="w-2 h-2 bg-surface-400 dark:bg-surface-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></span>
          <span class="w-2 h-2 bg-surface-400 dark:bg-surface-500 rounded-full animate-bounce" style="animation-delay: 300ms;"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="border-t border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 p-4">
    <div class="flex gap-2 items-center max-w-6xl mx-auto">
      <!-- Text Input Field -->
      <textarea
        pInputText
        [(ngModel)]="messageText"
        (keydown.enter)="onEnterKey($event)"
        [disabled]="isSending"
        placeholder="Write a message"
        aria-label="Type your message"
        role="textbox"
        rows="1"
        class="flex-1 resize-none rounded-lg border border-surface-300 dark:border-surface-600 px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-surface-800 dark:text-surface-0"
      ></textarea>

      <!-- Send Button -->
      <p-button
        icon="pi pi-send"
        (onClick)="sendMessage()"
        [disabled]="!canSend()"
        [attr.aria-label]="'Send message'"
        [attr.aria-disabled]="!canSend()"
        severity="primary"
        [rounded]="true"
        class="flex-shrink-0"
      />
    </div>
  </div>
</div>
