<!-- Chat Component Template -->
<div class="flex flex-col h-full bg-surface-0 dark:bg-surface-900">
  <!-- Messages Display Area -->
  <div 
    #messagesContainer
    class="flex-1 overflow-y-auto p-6 space-y-4"
    role="log"
    aria-live="polite"
    aria-relevant="additions"
  >
    <!-- Message Loop -->
    <ng-container *ngFor="let message of messages">
      <!-- Date Separator -->
      <div 
        *ngIf="message.isNewDay" 
        class="flex justify-center my-6"
      >
        <span class="px-4 py-2 text-xs font-semibold text-surface-600 dark:text-surface-400 bg-surface-100 dark:bg-surface-800 rounded-full shadow-sm">
          {{ message.dateLabel }}
        </span>
      </div>

      <!-- User Message (Right-aligned) -->
      <div 
        *ngIf="message.senderId === 'user'" 
        class="flex justify-end animate-fade-in"
      >
        <div class="flex flex-col items-end max-w-[80%]">
          <div class="bg-primary-500 text-white rounded-2xl rounded-tr-md px-5 py-3 shadow-md">
            <p class="text-sm whitespace-pre-wrap break-words leading-relaxed">{{ message.content }}</p>
          </div>
          <span class="text-xs text-surface-500 dark:text-surface-400 mt-1.5 px-2">
            {{ message.time }}
          </span>
        </div>
      </div>

      <!-- AI Message (Left-aligned) -->
      <div 
        *ngIf="message.senderId === 'ai'" 
        class="flex justify-start animate-fade-in"
      >
        <div class="flex gap-3 max-w-[80%]">
          <div class="flex-shrink-0 w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center mt-1">
            <i class="pi pi-sparkles text-primary-600 dark:text-primary-400 text-sm"></i>
          </div>
          <div class="flex flex-col items-start flex-1">
            <div class="bg-surface-100 dark:bg-surface-800 text-surface-900 dark:text-surface-0 rounded-2xl rounded-tl-md px-5 py-3 shadow-md">
              <p class="text-sm whitespace-pre-wrap break-words leading-relaxed">{{ message.content }}</p>
            </div>
            <span class="text-xs text-surface-500 dark:text-surface-400 mt-1.5 px-2">
              {{ message.time }}
            </span>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Typing Indicator -->
    <div 
      *ngIf="isTyping" 
      class="flex justify-start animate-fade-in"
    >
      <div class="flex gap-3">
        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
          <i class="pi pi-sparkles text-primary-600 dark:text-primary-400 text-sm"></i>
        </div>
        <div class="bg-surface-100 dark:bg-surface-800 rounded-2xl rounded-tl-md px-5 py-3 shadow-md">
          <div class="flex space-x-1.5">
            <span class="w-2 h-2 bg-surface-400 dark:bg-surface-500 rounded-full animate-bounce" style="animation-delay: 0ms;"></span>
            <span class="w-2 h-2 bg-surface-400 dark:bg-surface-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></span>
            <span class="w-2 h-2 bg-surface-400 dark:bg-surface-500 rounded-full animate-bounce" style="animation-delay: 300ms;"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="border-t border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 p-4">
    <div class="flex gap-3 items-end">
      <!-- Text Input Field -->
      <textarea
        [(ngModel)]="messageText"
        (keydown.enter)="onEnterKey($event)"
        [disabled]="isSending"
        placeholder="Digite sua mensagem..."
        aria-label="Type your message"
        role="textbox"
        rows="1"
        class="flex-1 resize-none rounded-xl border border-surface-300 dark:border-surface-600 bg-surface-0 dark:bg-surface-800 px-4 py-3 text-sm text-surface-900 dark:text-surface-0 placeholder:text-surface-500 dark:placeholder:text-surface-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
      ></textarea>

      <!-- Send Button -->
      <p-button
        icon="pi pi-send"
        (onClick)="sendMessage()"
        [disabled]="!canSend()"
        [attr.aria-label]="'Send message'"
        [attr.aria-disabled]="!canSend()"
        severity="primary"
        [rounded]="true"
        class="flex-shrink-0"
      />
    </div>
  </div>
</div>
